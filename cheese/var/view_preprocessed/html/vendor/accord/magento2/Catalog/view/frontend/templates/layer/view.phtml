<?php /** * Template for layer navigation view * * @var $block \Smile\ElasticsuiteCatalog\Block\Navigation */ if ($block->canShowBlock()) : $filters = count($block->getFilters()); $activeFilters = []; $filterPositionInLayout = -1; /** @var \Magento\Catalog\Model\Layer\Filter\FilterInterface $filter */ foreach ($block->getFilters() as $filter) { if (!$filter->getItemsCount()) { continue; } $filterPositionInLayout++; if ($filter->getName() == 'Category') { $activeFilters[] = $filterPositionInLayout; continue; } /** @var \Magento\Catalog\Model\Layer\Filter\FilterInterface $item */ foreach ($filter->getItems() as $item) { if ($item->getIsSelected()) { $activeFilters[] = $filterPositionInLayout; break; } } } $activeFilters = '[' . implode(',', $activeFilters) . ']'; ?> <div class="block filter" id="layered-filter-block" data-mage-init='{"collapsible":{"openedState": "active", "collapsible": true, "active": false, "collateral": { "openedState": "filter-active", "element": "body" } }}'><?php $filtered = count($block->getLayer()->getState()->getFilters()) ?> <div class="block-title filter-title" data-count="<?php /* @escapeNotVerified */ echo $filtered; ?>"><strong data-role="title"><?php /* @escapeNotVerified */ echo __('Shop By') ?></strong></div><div class="block-content filter-content"><?php echo $block->getChildHtml('state') ?> <?php if ($block->getLayer()->getState()->getFilters()) : ?> <div class="block-actions filter-actions"><a href="<?php /* @escapeNotVerified */ echo $block->getClearUrl() ?>" class="action clear filter-clear"><span><?php /* @escapeNotVerified */ echo __('Clear All') ?></span></a></div><?php endif; ?> <?php $wrapOptions = false; ?> <?php foreach ($block->getFilters() as $filter) : ?> <?php if ($filter->getItemsCount()) : ?> <?php if (!$wrapOptions) : ?> <strong role="heading" aria-level="2" class="block-subtitle filter-subtitle"><?php /* @escapeNotVerified */ echo __('Shopping Options') ?></strong> <dl class="filter-options" id="narrow-by-list" data-role="content" data-mage-init='{"accordion":{"openedState": "active", "collapsible": true, "active": <?= $activeFilters ?>, "multipleCollapsible": true}}'><?php $wrapOptions = true;?> <?php endif; ?> <dt data-role="title" class="filter-options-title"><?php /* @escapeNotVerified */ echo __($filter->getName()) ?></dt><dd data-role="collapsible" class="filter-options-item"><div data-role="content" class="filter-options-content"><?php /* @escapeNotVerified */ echo $block->getChildBlock('renderer')->render($filter); ?></div></dd><?php endif; ?> <?php endforeach; ?> <?php if ($wrapOptions) : ?></dl><?php else : ?> <script>
                require([
                    'jquery'
                ], function ($) {
                    $('#layered-filter-block').addClass('filter-no-options');
                });</script><?php endif; ?></div></div><?php endif; ?>